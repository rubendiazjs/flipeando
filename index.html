<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Snipping tool v0.01 — Drag to bookmarks</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; background:#f6f8fb; color:#0b1220; padding:28px; }
    .card { max-width:880px; margin:0 auto; background:#fff; border-radius:12px; padding:20px; box-shadow:0 6px 30px rgba(11,18,32,0.08); }
    h1 { margin:0 0 6px 0; font-size:20px; }
    p.lead { margin:6px 0 16px 0; color:#334155; }
    .btn { display:inline-block; background:#4f46e5; color:#fff; padding:12px 16px; border-radius:10px; text-decoration:none; font-weight:600; }
    .note { margin-top:12px; font-size:13px; color:#475569; }
    pre.small { background:#0b1220; color:#e6eefc; padding:12px; border-radius:8px; overflow:auto; font-size:12px; }
    ul { margin-left:18px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Snipping tool v0.01</h1>
    <p class="lead">Drag the link below to your bookmarks bar to add the snipping bookmarklet.</p>

    <p>
      <a class="btn" href="javascript:(function(){try{if(window.__sniperInjected){console.log('Sniper already injected.');return}window.__sniperInjected=true;let isRunning=!1,clickCount=0,statusLabel=null;let SELECTOR='.snipe-min-bid';const MICRO_PAUSE_MIN=400,MICRO_PAUSE_MAX=900,PRE_CLICK_MIN=600,PRE_CLICK_MAX=1600,MOUSE_HOLD_MIN=60,MOUSE_HOLD_MAX=220,POST_CLICK_COOLDOWN_MIN=800,POST_CLICK_COOLDOWN_MAX=2400,STABILITY_CHECK_MS=250,STORAGE_KEY='__sniper_settings_v1',defaults={waitAfterFoundMs:500,safePauseMs:1e4,attemptsPerRound:20};function loadSettings(){try{const r=localStorage.getItem(STORAGE_KEY);const p=r?JSON.parse(r):{};return Object.assign({},defaults,p)}catch{return Object.assign({},defaults)}}function saveSettings(s){localStorage.setItem(STORAGE_KEY,JSON.stringify(s))}let settings=loadSettings();const sleep=ms=>new Promise(r=>setTimeout(r,ms)),rand=(min,max)=>Math.floor(Math.random()*(max-min+1))+min,randomMicroPause=()=>rand(MICRO_PAUSE_MIN,MICRO_PAUSE_MAX);function isElementVisible(el){if(!el)return!1;const st=getComputedStyle(el);if(st.display==='none'||st.visibility==='hidden'||parseFloat(st.opacity)===0)return!1;const r=el.getBoundingClientRect();if(r.width===0||r.height===0)return!1;const vp=r.bottom>=0&&r.right>=0&&r.top<=((innerHeight||document.documentElement.clientHeight))&&r.left<=((innerWidth||document.documentElement.clientWidth));return!!vp}function waitForElement(selector,timeout=1e4){return new Promise(resolve=>{const first=document.querySelector(selector);if(first&&isElementVisible(first))return resolve(first);const obs=new MutationObserver(()=>{const found=document.querySelector(selector);if(found&&isElementVisible(found)){obs.disconnect();resolve(found)}});obs.observe(document.body,{childList:!0,subtree:!0});setTimeout(()=>{obs.disconnect();const final=document.querySelector(selector);resolve(final&&isElementVisible(final)?final:null)},timeout)})}async function ensureStable(el,ms=STABILITY_CHECK_MS){if(!el)return!1;try{const a=el.getBoundingClientRect();await sleep(ms);const b=el.getBoundingClientRect();return a.top===b.top&&a.left===b.left&&a.width===b.width&&a.height===b.height}catch{return!1}}function updateStatus(s){if(!statusLabel)return;statusLabel.textContent='Status: '+s;statusLabel.style.color={'🟢 Snipping':'#4CAF50','🟡 Micro Paused':'#FFD700','🟠 Safe Paused':'#FF9800','🔴 Stopped':'#f44336'}[s]||'#fff'}async function humanClick(el){if(!el)return!1;const extra=settings.waitAfterFoundMs,jitter=Math.round(extra*.2);updateStatus('🟡 Micro Paused');await sleep(Math.max(0,extra+rand(-jitter,jitter)));await sleep(rand(PRE_CLICK_MIN,PRE_CLICK_MAX));if(!isElementVisible(el))return!1;if(!await ensureStable(el))return!1;const r=el.getBoundingClientRect(),x=r.left+r.width/2,y=r.top+r.height/2,opts={bubbles:!0,cancelable:!0,view:window,clientX:x,clientY:y};el.dispatchEvent(new MouseEvent('mouseover',opts));el.dispatchEvent(new MouseEvent('mousemove',opts));el.dispatchEvent(new MouseEvent('mousedown',opts));await sleep(rand(MOUSE_HOLD_MIN,MOUSE_HOLD_MAX));el.dispatchEvent(new MouseEvent('mouseup',opts));el.dispatchEvent(new MouseEvent('click',opts));return!0}async function clickLoop(){while(isRunning){updateStatus('🟡 Micro Paused');const btn=await waitForElement(SELECTOR,1e4);if(!isRunning)break;await sleep(randomMicroPause());if(!isRunning)break;if(btn&&isElementVisible(btn)){updateStatus('🟢 Snipping');const ok=await humanClick(btn);if(ok){clickCount++;console.log('Click #'+clickCount+' at '+new Date().toLocaleTimeString());const cooldown=rand(POST_CLICK_COOLDOWN_MIN,POST_CLICK_COOLDOWN_MAX),start=Date.now();while(Date.now()-start<cooldown){if(!document.body.contains(btn)||!isElementVisible(btn))break;await sleep(150)}}else{await sleep(rand(300,800))}}else{await sleep(rand(600,1400))}if(settings.attemptsPerRound>0&&clickCount>0&&(clickCount%settings.attemptsPerRound===0)){updateStatus('🟠 Safe Paused');await sleep(Math.max(0,settings.safePauseMs|0))}}}function startClicker(){if(isRunning)return;isRunning=!0;clickCount=0;updateStatus('🟢 Snipping');clickLoop()}function stopClicker(){isRunning=!1;updateStatus('🔴 Stopped')}function createUI(){if(document.getElementById('sniper-floating-ui')){statusLabel=document.getElementById('sniper-status-label');return}const box=document.createElement('div');Object.assign(box.style,{position:'fixed',top:'10px',right:'10px',zIndex:2147483647,background:'rgba(0,0,0,0.8)',color:'#fff',padding:'10px',borderRadius:'8px',fontFamily:'sans-serif',minWidth:'220px'});box.id='sniper-floating-ui';const title=document.createElement('div');title.textContent='Snipping tool v0.01';title.style.fontWeight='600';title.style.marginBottom='6px';statusLabel=document.createElement('div');statusLabel.id='sniper-status-label';statusLabel.textContent='Status: 🔴 Stopped';statusLabel.style.marginBottom='8px';statusLabel.style.fontSize='13px';const row=(label,input)=>{const w=document.createElement('label');w.style.display='flex';w.style.alignItems='center';w.style.gap='8px';w.style.margin='4px 0';const s=document.createElement('span');s.textContent=label;s.style.minWidth='130px';s.style.fontSize='12px';w.appendChild(s);w.appendChild(input);return w};const makeNumber=(v,min,step=1)=>{const i=document.createElement('input');i.type='number';i.value=v;i.min=String(min);i.step=String(step);Object.assign(i.style,{width:'80px',padding:'2px 4px',borderRadius:'4px',border:'1px solid #555',background:'#111',color:'#fff'});return i};const inpWait=makeNumber(settings.waitAfterFoundMs,0,50),inpSafe=makeNumber(settings.safePauseMs,0,100),inpRounds=makeNumber(settings.attemptsPerRound,1,1);const btns=document.createElement('div');btns.style.display='flex';btns.style.gap='8px';btns.style.marginTop='8px';const startBtn=document.createElement('button'),stopBtn=document.createElement('button'),applyBtn=document.createElement('button');startBtn.textContent='▶ Start';stopBtn.textContent='⏹ Stop';applyBtn.textContent='Apply';const styleBtn=(b,bg)=>Object.assign(b.style,{background:bg,border:'none',color:'#fff',padding:'6px 10px',fontSize:'13px',borderRadius:'4px',cursor:'pointer'});styleBtn(startBtn,'#2e7d32');styleBtn(stopBtn,'#c62828');styleBtn(applyBtn,'#1565c0');startBtn.onclick=startClicker;stopBtn.onclick=stopClicker;applyBtn.onclick=()=>{settings={waitAfterFoundMs:Math.max(0,parseInt(inpWait.value||defaults.waitAfterFoundMs,10)),safePauseMs:Math.max(0,parseInt(inpSafe.value||defaults.safePauseMs,10)),attemptsPerRound:Math.max(1,parseInt(inpRounds.value||defaults.attemptsPerRound,10))};saveSettings(settings);applyBtn.textContent='Applied ✓';setTimeout(()=>applyBtn.textContent='Apply',1e3)};box.appendChild(title);box.appendChild(statusLabel);box.appendChild(row('Wait after found (ms)',inpWait));box.appendChild(row('Safe pause (ms)',inpSafe));box.appendChild(row('Attempts per round',inpRounds));btns.appendChild(startBtn);btns.appendChild(stopBtn);btns.appendChild(applyBtn);box.appendChild(btns);const hint=document.createElement('div');hint.textContent='Tip: Ctrl+Shift+S toggles Start/Stop';hint.style.opacity='0.8';hint.style.fontSize='11px';hint.style.marginTop='6px';box.appendChild(hint);document.body.appendChild(box)}async function maybeAskSelector(){const found=document.querySelector(SELECTOR);if(found)return;await sleep(300);if(!document.querySelector(SELECTOR)){const custom=prompt(&quot;Sniper: element '&quot;+SELECTOR+&quot;' not found.\\nEnter a CSS selector for the button you want to click (or Cancel to keep default):&quot;,SELECTOR);if(custom){SELECTOR=custom.trim();console.log('Sniper: using selector -&gt;',SELECTOR)}}}addEventListener('keydown',ev=&gt;{if(ev.ctrlKey&amp;&amp;ev.shiftKey&amp;&amp;ev.key.toLowerCase()==='s'){isRunning?stopClicker():startClicker()}});(async function init(){createUI();await maybeAskSelector();console.log('Sniper initialized. Selector:',SELECTOR,'Settings:',settings)})();}catch(e){console.error('Sniper error:',e);alert('Sniper bookmarklet error — see console (F12)')}})();">Snipping tool v0.01</a>
    </p>

    <div class="note">
      <strong>How to add:</strong>
      <ul>
        <li>If you don't see the bookmarks bar, press <kbd>Ctrl+Shift+B</kbd> (Windows) or <kbd>Cmd+Shift+B</kbd> (Mac).</li>
        <li>Drag the <strong>Snipping tool v0.01</strong> button above to your bookmarks bar.</li>
        <li>Go to the page you want to use it on and click the bookmark.</li>
      </ul>

      <p>If dragging is blocked, right-click the button, choose <em>Copy link address</em>, then create a new bookmark manually and paste the URL.</p>
      <p>When you click the bookmark, a floating UI will appear top-right. Adjust timings, hit <em>Apply</em>, then <strong>Start</strong>. Toggle quickly with <kbd>Ctrl+Shift+S</kbd>.</p>
    </div>
  </div>
</body>
</html>
